(function(){function t(t,a,i,r){function h(){G="object"==typeof i?i:a.src||r?u:document.createElement("canvas"),G.width=s,G.height=f,J=G.getContext("2d")}function n(t){if(t){var e,a=J.getImageData(0,0,s,f),i=a.data;for(e=0;it>e;e+=4)i[e]=t[e]*rt|0,i[e+1]=t[e+1]*rt|0,i[e+2]=t[e+2]*rt|0,i[e+3]=t[e+3]*rt|0;return delete t,a}return J.getImageData(0,0,s,f)}function o(t,e,a,i,r){return.5*(i-e+(2*e-5*a+4*i-r+(3*(a-i)+r-e)*t)*t)*t+a}a||(a=t.input,i=t.output,r=t.inputRemovable,t.scale&&(t=t.scale));var u,d;if(a.src)if(u=document.createElement("canvas"),null!=a.naturalWidth)u.width=a.naturalWidth,u.height=a.naturalHeight;else if(null!=a.runtimeStyle){var l=a.runtimeStyle,c=l.width,g=l.height;l.width="auto",l.height="auto",u.width=a.width,u.height=a.height,l.width=c,l.height=g}else{var c=a.width,g=a.height;a.removeAttribute&&(a.removeAttribute("width"),a.removeAttribute("height")),u.width=a.width,u.height=a.height,a.width=c,a.height=g}else u=a;d=u.getContext("2d"),a.src&&d.drawImage(a,0,0);var s,f,m=u.width,w=u.height,p=d.getImageData(0,0,m,w).data;if(!m||!w)return!1;(a.src||r)&&u.clearRect(0,0,m,w),"object"==typeof t?t.width?(s=t.width+.5|0,f=t.height+.5|0):(s=m*t.scaleX+.5|0,f=w*t.scaleY+.5|0):(s=t*m+.5|0,f=t*w+.5|0);var v,b,y,x,D,I,A,j,R,k,C,E,F,L,S,U,W,H,X,Y,q,z,B,G,J,K,M,N,O,P,Q,T,V,Z,$,_=s<<2,tt=m<<2,et=0,at=0,it=_*f,rt=255.99/255,ht=s/m,nt=f/w,ot=ht*nt;if(ht>1||nt>1)for(h(),K=n(),M=K.data,x=0;f>x;x++)for(b=x/nt,R=0|b,z=b-R,O=R*tt,N=1>R?O:O-tt,w-2>R?(P=O+tt,Q=(R+2)*tt):P=Q=R>w-2?O:O+tt,y=0;s>y;y++,at+=4)v=y/ht,j=0|v,B=v-j,V=j<<2,T=1>j?V:V-4,m-2>j?(Z=V+4,$=V+8):Z=$=j>m-2?V:V+4,H=o(z,o(B,p[N+T],p[N+V],p[N+Z],p[N+$]),o(B,p[O+T],p[O+V],p[O+Z],p[O+$]),o(B,p[P+T],p[P+V],p[P+Z],p[P+$]),o(B,p[Q+T],p[Q+V],p[Q+Z],p[Q+$]))*rt|0,++T,++V,++Z,++$,X=o(z,o(B,p[N+T],p[N+V],p[N+Z],p[N+$]),o(B,p[O+T],p[O+V],p[O+Z],p[O+$]),o(B,p[P+T],p[P+V],p[P+Z],p[P+$]),o(B,p[Q+T],p[Q+V],p[Q+Z],p[Q+$]))*rt|0,++T,++V,++Z,++$,Y=o(z,o(B,p[N+T],p[N+V],p[N+Z],p[N+$]),o(B,p[O+T],p[O+V],p[O+Z],p[O+$]),o(B,p[P+T],p[P+V],p[P+Z],p[P+$]),o(B,p[Q+T],p[Q+V],p[Q+Z],p[Q+$]))*rt|0,M[at]=H>=0?256>H?H:255:0,M[at+1]=X>=0?256>X?X:255:0,M[at+2]=Y>=0?256>Y?Y:255:0,++T,++V,++Z,++$,q=o(z,o(B,p[N+T],p[N+V],p[N+Z],p[N+$]),o(B,p[O+T],p[O+V],p[O+Z],p[O+$]),o(B,p[P+T],p[P+V],p[P+Z],p[P+$]),o(B,p[Q+T],p[Q+V],p[Q+Z],p[Q+$]))*rt|0,M[at+3]=q>=0?256>q?q:255:0;else{if(e.Float32Array)W=new Float32Array(it);else for(W=[],at=0;it>at;++at)W[at]=0;for(b=0;w>b;b++)for(x=b*nt,A=0|x,D=A*_,U=!!((A-(x+nt|0))*(w-1-b))<<1,U&&(F=A+1-x,L=x+nt-A-1),v=0;m>v;v++,et+=4)switch(y=v*ht,I=0|y,at=D+(I<<2),S=!!((I-(y+ht|0))*(m-1-v)),S&&(C=I+1-y,E=y+ht-I-1),H=p[et],X=p[et+1],Y=p[et+2],q=p[et+3],S+U){case 0:W[at]+=H*ot,W[at+1]+=X*ot,W[at+2]+=Y*ot,W[at+3]+=q*ot;break;case 1:k=C*nt,W[at]+=H*k,W[at+1]+=X*k,W[at+2]+=Y*k,W[at+3]+=q*k,k=E*nt,W[at+4]+=H*k,W[at+5]+=X*k,W[at+6]+=Y*k,W[at+7]+=q*k;break;case 2:k=ht*F,W[at]+=H*k,W[at+1]+=X*k,W[at+2]+=Y*k,W[at+3]+=q*k,k=ht*L,at+=_,W[at]+=H*k,W[at+1]+=X*k,W[at+2]+=Y*k,W[at+3]+=q*k;break;default:k=C*F,W[at]+=H*k,W[at+1]+=X*k,W[at+2]+=Y*k,W[at+3]+=q*k,k=E*F,W[at+4]+=H*k,W[at+5]+=X*k,W[at+6]+=Y*k,W[at+7]+=q*k,k=C*L,at+=_,W[at]+=H*k,W[at+1]+=X*k,W[at+2]+=Y*k,W[at+3]+=q*k,k=E*L,W[at+4]+=H*k,W[at+5]+=X*k,W[at+6]+=Y*k,W[at+7]+=q*k}delete p,h(),K=n(W)}if(J.putImageData(K,0,0),"string"==typeof i){if("png"===i||"jpeg"===i){var ut;return ut=r&&a.src?a:new Image,ut.width=s,ut.height=f,ut.src=G.toDataURL("image/"+i,1),ut}if("png-src"===i||"jpeg-src"===i)return G.toDataURL("image/"+i.split("-")[0],1)}return G}var e=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.scale=t):e.scale=t}).call(this);